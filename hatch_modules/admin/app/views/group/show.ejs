<div class="row">

    <% include _sidebar %>

    <div class="span10">
        <div class="module">
            <div class="content">

                <%- formTagBegin({ action: pathTo.groupSave, id: 'settingsForm', class: 'form-vertical', method: 'post', enctype: 'multipart/form-data', remote: true }) -%>

                    <% if(tab == 'settings') { %>
                        <h3>
                            <%- t('group.headers.settings') %>
                        </h3>

                        <hr/>

                        <div class="control-group">
                            <label class="control-label" for="name"><%- t('group.labels.title') %></label>
                            <div class="controls">
                                <input type="text" class="input-xlarge" id="name" name="name" value="<%- group.name %>">
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label" for="joinPermissions">
                                <span>
                                    <%- t('group.labels.joinPermissions') %>
                                    <i class="icon-info-sign" rel="popover" title="<%- t('common.help') %>" data-content="<%- t('group.help.joinPermissions') %>"></i>
                                </span>
                            </label>
                            <div class="controls">
                                <select id="joinPermissions" name="joinPermissions">
                                    <option value="free" <%- group.joinPermissions == "free" ? 'selected="selected"':'' %>><%- t('group.labels.freeToJoin') %></option>
                                    <option value="request" <%- group.joinPermissions == "request" ? 'selected="selected"':'' %>><%- t('group.labels.requestToJoin') %></option>
                                    <option value="closed" <%- group.joinPermissions == "closed" ? 'selected="selected"':'' %>><%- t('group.labels.inviteOnly') %></option>
                                </select>
                            </div>
                        </div>

                        <hr/>

                        <div class="control-group">
                            <input type="hidden" id="favicon" name="favicon" value="<%- group.favicon %>" />
                            <label class="control-label" for="favicon"><%- t('group.labels.favicon') %></label>
                            <div class="controls">
                                <a class="btn" href="#" id="faviconButton"><i class="icon-picture"></i> <%- t('group.actions.uploadFavicon') %></a>

                                <% if(group.favicon) { %>
                                    <img src="<%- group.favicon %>" id="faviconPreview" width="16" height="16" />
                                <% } %>
                            </div>

                            <br/>
                        </div>

                        <div class="control-group">
                            <label class="control-label" for="metaDescription">
                                <span>
                                    <%- t(['group.labels.metaDescription', '&lt;metatags&gt;']) %>
                                    <i class="icon-info-sign"  rel="popover" title="<%- t('common.help') %>" data-content="<%- t('group.help.metaDescription') %>"></i>
                                </span>
                            </label>
                            <div class="controls">
                                <textarea class="input-xlarge span4" id="metaDescription" name="metaDescription"><%- group.metaDescription %></textarea>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label" for="metaKeywords">
                                <span>
                                    <%- t(['group.labels.metaKeywords', '&lt;metatags&gt;']) %>
                                    <i class="icon-info-sign" rel="popover" title="<%- t('common.help') %>" data-content="<%- t('group.help.metaKeywords') %>"></i>
                                </span>
                            </label>
                            <div class="controls">
                                <input type="text" class="input-xlarge" id="metaKeywords" name="metaKeywords" value="<%- group.metaKeywords %>">
                            </div>
                        </div>

                    <% } else if(tab == 'url') { %>

                        <h3><%- t('group.headers.changeUrl') %></h3>

                        <hr/>

                        <div class="control-group">
                            <label class="control-label" for="url"><%- t('group.labels.url') %></label>
                            <div class="controls">
                                <input type="text" class="input-xlarge" id="url" name="url" />
                            </div>
                        </div>

                    <% } else if(tab == 'headerfooter') { %>

                        <h3><%- t('group.headers.headerfooter') %></h3>

                        <hr/>

                        <div class="control-group">
                            <label class="control-label" for="navBarType">
                                <%- t('group.labels.navbarType') %>
                            </label>
                            <div class="controls">
                                <select id="navBarType" name="navBarType">
                                    <option value="default"><%- t('group.labels.navbarDefault') %></option>
                                    <option value="fixed" <%- group.navBarType === 'fixed' ? 'selected="selected"':'' %>><%- t('group.labels.navbarFixed') %></option>
                                    <option value="mouseover" <%- group.navBarType === 'mouseover' ? 'selected="selected"':'' %>><%- t('group.labels.navbarMouseover') %></option>
                                    <option value="click" <%- group.navBarType === 'click' ? 'selected="selected"':'' %>><%- t('group.labels.navbarMouseclick') %></option>
                                </select>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label" for="navBarStyle">
                                <%- t('group.labels.navbarStyle') %>
                            </label>
                            <div class="controls">
                                <select id="navBarStyle" name="navBarStyle">
                                    <option value="default"><%- t('group.labels.navbarDefault') %></option>
                                    <option value="inverse" <%- group.navBarStyle === 'inverse' ? 'selected="selected"':'' %>><%- t('group.labels.navbarInverse') %></option>
                                </select>
                            </div>
                        </div>

                        <hr/>

                        <div class="control-group">
                            <label class="control-label" for="headerHtml">
                                <span>
                                    <%- t('group.labels.headerHtml') %>
                                    <i class="icon-info-sign" rel="popover" title="<%- t('common.help') %>" data-content="<%- t('group.help.headerHtml') %>"></i>
                                </span>
                            </label>
                            <div class="controls">
                                <textarea class="input-xlarge span6 richtext" id="headerHtml" name="headerHtml" rows="10"><%- group.headerHtml %></textarea>
                            </div>
                        </div>

                        <hr/>

                        <div class="control-group">
                            <label class="control-label" for="footerHtml">
                                <span>
                                    <%- t('group.labels.footerHtml') %>
                                    <i class="icon-info-sign" rel="popover" title="<%- t('common.help') %>" data-content="<%- t('group.help.footerHtml') %>"></i>
                                </span>
                            </label>
                            <div class="controls">
                                <textarea class="input-xlarge span6 richtext" id="footerHtml" name="footerHtml" rows="10"><%- group.footerHtml %></textarea>
                            </div>
                        </div>

                    <% } else if(tab == 'analytics') { %>

                        <h3><%- t('group.headers.analytics') %></h3>

                        <hr/>

                        <div class="control-group">
                            <label class="control-label" for="googleAnalyticsId"><%- t('group.labels.googleAnalytics') %></label>
                            <div class="controls">
                                <input type="text" class="input-xlarge" id="googleAnalyticsId" name="googleAnalyticsId" value="<%- group.googleAnalyticsId %>">
                            </div>
                            <span class="help-block"><%- t('group.help.googleAnalytics') %></span>
                        </div>

                    <% } %>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary"><%- t('group.actions.save') %></button>
                    </div>
                <%- formTagEnd() %>

            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function() {
        //bind the form ajax
        $('#settingsForm').bind('ajax:success', function(e, data) {
            $.noty({text: '<i class="icon-' + data.icon + '"></i> ' + data.message, type: data.status});

            //refresh the page
            setTimeout(function() { window.location = window.location; }, 1000);
        });

        //setup the file uploader
        <% if(tab == 'settings') { %>
            var uploader = new qq.FileUploader({
                params: { _csrf: $('meta[name=csrf-token]').attr('content') },
                element: $('#faviconButton').get(0),
                action: '<%- pathFor('upload').add -%>',
                uploadButtonText: $('#faviconButton').html(),
                encoding: 'multipart',
                onComplete: function(id, filename, data) {
                    $('#favicon').val(data.url);
                    $('#faviconPreview').attr('src', data.url);

                    $.noty({ text: '<i class="icon-ok"></i> <%- t('group.help.faviconUploaded') %>', type: 'success' });
                }
            });
        <% } %>

        //convert richtexts
        setupRichtextEditors(null, { fixed: false });
    });
</script>

